---
# External Secret to provision Argo CD repository credentials for 5dlabs/charts
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-repo-5dlabs-charts
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-secret-store
    kind: ClusterSecretStore
  target:
    name: repo-5dlabs-charts
    creationPolicy: Owner
    template:
      metadata:
        annotations:
          argocd.argoproj.io/secret-type: repository
      type: Opaque
      data:
        type: git
        url: https://github.com/5dlabs/charts
        username: "oauth2"
        password: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: github-pat
      property: token

---
# External Secret to provision Argo CD repository credentials for 5dlabs/cto
# This repository is used by multiple ArgoCD applications and needs authentication
# to avoid rate limiting and improve reliability of git fetch operations
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-repo-5dlabs-cto
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-secret-store
    kind: ClusterSecretStore
  target:
    name: repo-5dlabs-cto
    creationPolicy: Owner
    template:
      metadata:
        annotations:
          argocd.argoproj.io/secret-type: repository
      type: Opaque
      data:
        type: git
        url: https://github.com/5dlabs/cto
        username: "oauth2"
        password: "{{ .token }}"
  data:
  - secretKey: token
    remoteRef:
      key: github-pat
      property: token
