---
# Kustomization for cloudflare-operator
# Uses upstream default namespace: cloudflare-operator-system
# This keeps the operator and its managed tunnel pods together
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - https://github.com/adyanth/cloudflare-operator.git/config/default?ref=v0.13.1

# Add log collection labels to the operator deployment
patches:
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: cloudflare-operator-controller-manager
        namespace: cloudflare-operator-system
      spec:
        template:
          metadata:
            labels:
              app.kubernetes.io/component: tunnel-operator
              platform.5dlabs.io/log-collection: enabled
            annotations:
              logs.platform.5dlabs.io/collect: "true"
              logs.platform.5dlabs.io/service: cloudflare-operator
