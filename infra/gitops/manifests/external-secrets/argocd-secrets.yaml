---
# ExternalSecrets for ArgoCD namespace
# These secrets provide GitHub repository credentials for ArgoCD to fetch GitOps manifests

# =============================================================================
# argocd-repo-creds - GitHub credentials for ArgoCD repository access
# =============================================================================
# ArgoCD uses this secret to authenticate when cloning private repositories.
# The secret must be labeled with argocd.argoproj.io/secret-type=repo-creds
# to be recognized by ArgoCD as repository credentials.
#
# This provides credentials for all 5dlabs/* repositories via URL prefix matching.
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-repo-creds
  namespace: argocd
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: argocd-repo-creds
    creationPolicy: Owner
    template:
      metadata:
        labels:
          argocd.argoproj.io/secret-type: repo-creds
      data:
        type: git
        url: https://github.com/5dlabs
        username: "x-access-token"
        password: "{{ .token }}"
  data:
    - secretKey: token
      remoteRef:
        key: tools-github
        property: GITHUB_PERSONAL_ACCESS_TOKEN

