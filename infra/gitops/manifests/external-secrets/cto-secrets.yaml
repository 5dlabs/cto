---
# ExternalSecrets for CTO namespace
# These secrets are automatically synced from OpenBao when it's unsealed
# Eliminates manual secret creation after cluster recovery

# =============================================================================
# ghcr-secret - Docker registry credentials for ghcr.io/5dlabs images
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ghcr-secret
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: ghcr-secret
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: "{{ .dockerconfigjson }}"
  data:
    - secretKey: dockerconfigjson
      remoteRef:
        key: ghcr-secret
        property: .dockerconfigjson

---
# =============================================================================
# cto-secrets - API keys for AI providers and services
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cto-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: cto-secrets
    creationPolicy: Owner
  data:
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: api-keys
        property: ANTHROPIC_API_KEY
    - secretKey: CONTEXT7_API_KEY
      remoteRef:
        key: api-keys
        property: CONTEXT7_API_KEY
    - secretKey: CURSOR_API_KEY
      remoteRef:
        key: api-keys
        property: CURSOR_API_KEY
    - secretKey: FACTORY_API_KEY
      remoteRef:
        key: api-keys
        property: FACTORY_API_KEY
    - secretKey: GEMINI_API_KEY
      remoteRef:
        key: api-keys
        property: GEMINI_API_KEY
    - secretKey: GOOGLE_API_KEY
      remoteRef:
        key: api-keys
        property: GOOGLE_API_KEY
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: api-keys
        property: OPENAI_API_KEY
    - secretKey: PERPLEXITY_API_KEY
      remoteRef:
        key: api-keys
        property: PERPLEXITY_API_KEY
    - secretKey: XAI_API_KEY
      remoteRef:
        key: api-keys
        property: XAI_API_KEY

---
# =============================================================================
# linear-secrets - Linear API credentials for project management integration
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: linear-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: linear-secrets
    creationPolicy: Owner
  data:
    - secretKey: LINEAR_API_KEY
      remoteRef:
        key: linear-sync
        property: LINEAR_API_KEY
    - secretKey: LINEAR_CLIENT_ID
      remoteRef:
        key: linear-sync
        property: LINEAR_CLIENT_ID
    - secretKey: LINEAR_CLIENT_SECRET
      remoteRef:
        key: linear-sync
        property: LINEAR_CLIENT_SECRET
    - secretKey: LINEAR_OAUTH_TOKEN
      remoteRef:
        key: linear-sync
        property: LINEAR_OAUTH_TOKEN
    - secretKey: LINEAR_WEBHOOK_SECRET
      remoteRef:
        key: linear-sync
        property: LINEAR_WEBHOOK_SECRET

---
# =============================================================================
# research-twitter-secrets - Twitter/X API credentials for research polling
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: research-twitter-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: research-twitter-secrets
    creationPolicy: Owner
  data:
    - secretKey: TWITTER_AUTH_TOKEN
      remoteRef:
        key: research-twitter
        property: TWITTER_AUTH_TOKEN
    - secretKey: TWITTER_CT0
      remoteRef:
        key: research-twitter
        property: TWITTER_CT0

---
# =============================================================================
# tools-github-secrets - GitHub PAT for tools integration
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-github-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-github-secrets
    creationPolicy: Owner
  data:
    - secretKey: GITHUB_PERSONAL_ACCESS_TOKEN
      remoteRef:
        key: tools-github
        property: GITHUB_PERSONAL_ACCESS_TOKEN

---
# =============================================================================
# tools-firecrawl-secrets - Firecrawl API key for web scraping
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-firecrawl-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-firecrawl-secrets
    creationPolicy: Owner
  data:
    - secretKey: FIRECRAWL_API_KEY
      remoteRef:
        key: tools-firecrawl
        property: FIRECRAWL_API_KEY

---
# =============================================================================
# tools-kubernetes-secrets - Kubeconfig for tools MCP server
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-kubernetes-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-kubernetes-secrets
    creationPolicy: Owner
  data:
    - secretKey: KUBECONFIG
      remoteRef:
        key: tools-kubernetes
        property: KUBECONFIG

---
# =============================================================================
# github-app-5dlabs-morgan - GitHub App credentials for Morgan agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-morgan
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-morgan
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-morgan
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-morgan
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-morgan
        property: private-key
