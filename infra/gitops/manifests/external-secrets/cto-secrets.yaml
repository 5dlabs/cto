---
# ExternalSecrets for CTO namespace
# These secrets are automatically synced from OpenBao when it's unsealed
# Eliminates manual secret creation after cluster recovery

# =============================================================================
# ghcr-secret - Docker registry credentials for ghcr.io/5dlabs images
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ghcr-secret
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: ghcr-secret
    creationPolicy: Owner
    template:
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: "{{ .dockerconfigjson }}"
  data:
    - secretKey: dockerconfigjson
      remoteRef:
        key: ghcr-secret
        property: .dockerconfigjson

---
# =============================================================================
# cto-secrets - API keys for AI providers and services
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: cto-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: cto-secrets
    creationPolicy: Owner
  data:
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: api-keys
        property: ANTHROPIC_API_KEY
    - secretKey: CONTEXT7_API_KEY
      remoteRef:
        key: api-keys
        property: CONTEXT7_API_KEY
    - secretKey: CURSOR_API_KEY
      remoteRef:
        key: api-keys
        property: CURSOR_API_KEY
    - secretKey: FACTORY_API_KEY
      remoteRef:
        key: api-keys
        property: FACTORY_API_KEY
    - secretKey: GEMINI_API_KEY
      remoteRef:
        key: api-keys
        property: GEMINI_API_KEY
    - secretKey: GOOGLE_API_KEY
      remoteRef:
        key: api-keys
        property: GOOGLE_API_KEY
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: api-keys
        property: OPENAI_API_KEY
    - secretKey: PERPLEXITY_API_KEY
      remoteRef:
        key: api-keys
        property: PERPLEXITY_API_KEY
    - secretKey: XAI_API_KEY
      remoteRef:
        key: api-keys
        property: XAI_API_KEY

---
# =============================================================================
# linear-secrets - Linear API credentials for project management integration
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: linear-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: linear-secrets
    creationPolicy: Owner
  data:
    - secretKey: LINEAR_API_KEY
      remoteRef:
        key: linear-sync
        property: LINEAR_API_KEY
    - secretKey: LINEAR_CLIENT_ID
      remoteRef:
        key: linear-sync
        property: LINEAR_CLIENT_ID
    - secretKey: LINEAR_CLIENT_SECRET
      remoteRef:
        key: linear-sync
        property: LINEAR_CLIENT_SECRET
    - secretKey: LINEAR_OAUTH_TOKEN
      remoteRef:
        key: linear-sync
        property: LINEAR_OAUTH_TOKEN
    - secretKey: LINEAR_WEBHOOK_SECRET
      remoteRef:
        key: linear-sync
        property: LINEAR_WEBHOOK_SECRET
    # GitHub token for fetching tasks.json from repositories on PR merge
    # Uses the same PAT as the tools MCP server
    - secretKey: GITHUB_TOKEN  # pragma: allowlist secret
      remoteRef:
        key: tools-github
        property: GITHUB_PERSONAL_ACCESS_TOKEN

---
# =============================================================================
# research-twitter-secrets - Twitter/X API credentials for research polling
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: research-twitter-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: research-twitter-secrets
    creationPolicy: Owner
  data:
    - secretKey: TWITTER_AUTH_TOKEN
      remoteRef:
        key: research-twitter
        property: TWITTER_AUTH_TOKEN
    - secretKey: TWITTER_CT0
      remoteRef:
        key: research-twitter
        property: TWITTER_CT0

---
# =============================================================================
# research-digest-secrets - Gmail SMTP credentials + digest settings
# Required OpenBao path: secret/research-digest
# Properties: GMAIL_USERNAME, GMAIL_APP_PASSWORD, DIGEST_TO_EMAIL,
#             DIGEST_BURST_THRESHOLD, DIGEST_MIN_ENTRIES
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: research-digest-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: research-digest-secrets
    creationPolicy: Owner
  data:
    - secretKey: GMAIL_USERNAME # pragma: allowlist secret
      remoteRef:
        key: research-digest
        property: GMAIL_USERNAME
    - secretKey: GMAIL_APP_PASSWORD # pragma: allowlist secret
      remoteRef:
        key: research-digest
        property: GMAIL_APP_PASSWORD
    - secretKey: DIGEST_TO_EMAIL # pragma: allowlist secret
      remoteRef:
        key: research-digest
        property: DIGEST_TO_EMAIL
    - secretKey: DIGEST_BURST_THRESHOLD # pragma: allowlist secret
      remoteRef:
        key: research-digest
        property: DIGEST_BURST_THRESHOLD
    - secretKey: DIGEST_MIN_ENTRIES # pragma: allowlist secret
      remoteRef:
        key: research-digest
        property: DIGEST_MIN_ENTRIES

---
# =============================================================================
# tools-github-secrets - GitHub PAT for tools integration
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-github-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-github-secrets
    creationPolicy: Owner
  data:
    - secretKey: GITHUB_PERSONAL_ACCESS_TOKEN
      remoteRef:
        key: tools-github
        property: GITHUB_PERSONAL_ACCESS_TOKEN

---
# =============================================================================
# tools-firecrawl-secrets - Firecrawl API key for web scraping
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-firecrawl-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-firecrawl-secrets
    creationPolicy: Owner
  data:
    - secretKey: FIRECRAWL_API_KEY
      remoteRef:
        key: tools-firecrawl
        property: FIRECRAWL_API_KEY

---
# =============================================================================
# tools-kubernetes-secrets - Kubeconfig for tools MCP server
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: tools-kubernetes-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: tools-kubernetes-secrets
    creationPolicy: Owner
  data:
    - secretKey: KUBECONFIG
      remoteRef:
        key: tools-kubernetes
        property: KUBECONFIG

---
# =============================================================================
# github-app-5dlabs-morgan - GitHub App credentials for Morgan agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-morgan
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-morgan
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-morgan
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-morgan
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-morgan
        property: private-key

---
# =============================================================================
# github-app-5dlabs-rex - GitHub App credentials for Rex agent (Rust backend)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-rex
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-rex
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-rex
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-rex
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-rex
        property: private-key

---
# =============================================================================
# github-app-5dlabs-blaze - GitHub App credentials for Blaze agent (Frontend)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-blaze
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-blaze
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-blaze
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-blaze
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-blaze
        property: private-key

---
# =============================================================================
# github-app-5dlabs-bolt - GitHub App credentials for Bolt agent (Infrastructure)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-bolt
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-bolt
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-bolt
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-bolt
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-bolt
        property: private-key

---
# =============================================================================
# github-app-5dlabs-cleo - GitHub App credentials for Cleo agent (Quality)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-cleo
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-cleo
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-cleo
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-cleo
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-cleo
        property: private-key

---
# =============================================================================
# github-app-5dlabs-tess - GitHub App credentials for Tess agent (Testing)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-tess
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-tess
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-tess
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-tess
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-tess
        property: private-key

---
# =============================================================================
# github-app-5dlabs-atlas - GitHub App credentials for Atlas agent (Integration)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-atlas
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-atlas
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-atlas
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-atlas
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-atlas
        property: private-key

---
# =============================================================================
# github-app-5dlabs-cipher - GitHub App credentials for Cipher agent (Security)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-cipher
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-cipher
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-cipher
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-cipher
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-cipher
        property: private-key

---
# =============================================================================
# github-app-5dlabs-spark - GitHub App credentials for Spark agent (Mobile/React Native)
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-spark
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-spark
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-spark
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-spark
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-spark
        property: private-key

---
# =============================================================================
# github-app-5dlabs-grizz - GitHub App credentials for Grizz agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-grizz
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-grizz
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-grizz
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-grizz
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-grizz
        property: private-key

---
# =============================================================================
# github-app-5dlabs-nova - GitHub App credentials for Nova agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-nova
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-nova
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-nova
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-nova
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-nova
        property: private-key

---
# =============================================================================
# github-app-5dlabs-tap - GitHub App credentials for Tap agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-tap
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-tap
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-tap
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-tap
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-tap
        property: private-key

---
# =============================================================================
# github-app-5dlabs-stitch - GitHub App credentials for Stitch agent
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: github-app-5dlabs-stitch
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: github-app-5dlabs-stitch
    creationPolicy: Owner
  data:
    - secretKey: app-id
      remoteRef:
        key: github-app-stitch
        property: app-id
    - secretKey: client-id
      remoteRef:
        key: github-app-stitch
        property: client-id
    - secretKey: private-key
      remoteRef:
        key: github-app-stitch
        property: private-key

---
# =============================================================================
# agent-platform-secrets - API keys for Argo Workflow pods (all CLIs)
# =============================================================================
# This populates the agent-platform-secrets used by intake and play workflows.
# Includes ALL API keys for different CLI providers: Claude, OpenAI, Gemini, etc.
# Uses Owner policy to fully manage the secret (replacing Helm placeholder).
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: agent-platform-secrets
  namespace: cto
  labels:
    app.kubernetes.io/managed-by: external-secrets
    app.kubernetes.io/component: workflow-secrets
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao
    kind: ClusterSecretStore
  target:
    name: agent-platform-secrets
    creationPolicy: Owner
  data:
    # Claude CLI (Anthropic)
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: api-keys
        property: ANTHROPIC_API_KEY
    # OpenAI / Codex CLI
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: api-keys
        property: OPENAI_API_KEY
    # Gemini CLI (Google)
    - secretKey: GEMINI_API_KEY
      remoteRef:
        key: api-keys
        property: GEMINI_API_KEY
    - secretKey: GOOGLE_API_KEY
      remoteRef:
        key: api-keys
        property: GOOGLE_API_KEY
    # Cursor CLI
    - secretKey: CURSOR_API_KEY
      remoteRef:
        key: api-keys
        property: CURSOR_API_KEY
    # Context7 for documentation lookups
    - secretKey: CONTEXT7_API_KEY
      remoteRef:
        key: api-keys
        property: CONTEXT7_API_KEY
    # Perplexity for web search
    - secretKey: PERPLEXITY_API_KEY
      remoteRef:
        key: api-keys
        property: PERPLEXITY_API_KEY
    # xAI (Grok)
    - secretKey: XAI_API_KEY
      remoteRef:
        key: api-keys
        property: XAI_API_KEY
    # Factory API
    - secretKey: FACTORY_API_KEY
      remoteRef:
        key: api-keys
        property: FACTORY_API_KEY
    # Brave Search API
    - secretKey: BRAVE_API_KEY  # pragma: allowlist secret
      remoteRef:
        key: api-keys
        property: BRAVE_API_KEY
