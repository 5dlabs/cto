---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: argo-workflow-agent-platform-binding
  namespace: agent-platform
  annotations:
    description: "Allows argo-workflow ServiceAccount from argo namespace to patch workflows in agent-platform namespace for Play workflow resumption"
subjects:
- kind: ServiceAccount
  name: argo-workflow
  namespace: argo
roleRef:
  kind: Role
  name: argo-events-workflows-agent-platform
  apiGroup: rbac.authorization.k8s.io
---
# Also ensure argo-workflow can access workflows in its own namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: argo-workflow-argo-namespace-binding
  namespace: argo
  annotations:
    description: "Allows argo-workflow ServiceAccount to manage workflows in argo namespace"
subjects:
- kind: ServiceAccount
  name: argo-workflow
  namespace: argo
roleRef:
  kind: ClusterRole
  name: argo-workflow
  apiGroup: rbac.authorization.k8s.io
---
# Allow argo-workflow SA in agent-platform to create CodeRuns locally
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: argo-workflow-local-binding
  namespace: agent-platform
  annotations:
    description: "Allows argo-workflow ServiceAccount in agent-platform namespace to create CodeRuns"
subjects:
- kind: ServiceAccount
  name: argo-workflow
  namespace: agent-platform
roleRef:
  kind: Role
  name: argo-events-workflows-agent-platform
  apiGroup: rbac.authorization.k8s.io
