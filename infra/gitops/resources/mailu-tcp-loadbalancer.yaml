---
# NGrok LoadBalancer service for Mailu mail ports
# This creates TCP addresses automatically via NGrok operator
apiVersion: v1
kind: Service
metadata:
  name: mailu-tcp-loadbalancer
  namespace: mailu
  labels:
    app.kubernetes.io/name: mailu
    app.kubernetes.io/component: mail-tcp
    app.kubernetes.io/part-of: mailu
  annotations:
    # Removed custom domain due to NGrok ACL restrictions
    # external-dns.alpha.kubernetes.io/hostname: "mail.5dlabs.ai"
    # external-dns.alpha.kubernetes.io/cloudflare-proxied: "false"
spec:
  type: LoadBalancer
  loadBalancerClass: ngrok
  allocateLoadBalancerNodePorts: false
  externalTrafficPolicy: Local
  selector:
    app.kubernetes.io/component: front
    app.kubernetes.io/instance: mailu
    app.kubernetes.io/name: mailu
  ports:
    # Secure mail ports only
    - name: smtp
      port: 25
      protocol: TCP
      targetPort: 25
    - name: smtps
      port: 465
      protocol: TCP
      targetPort: 465
    - name: submission
      port: 587
      protocol: TCP
      targetPort: 587
    - name: imaps
      port: 993
      protocol: TCP
      targetPort: 993
    - name: pop3s
      port: 995
      protocol: TCP
      targetPort: 995
    - name: sieve
      port: 4190
      protocol: TCP
      targetPort: 4190
