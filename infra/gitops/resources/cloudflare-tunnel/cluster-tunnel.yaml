---
# ClusterTunnel: Main Cloudflare Tunnel for CTO Platform
# This creates a cluster-wide tunnel that can be referenced by TunnelBindings
# across all namespaces.
#
# The operator will:
# 1. Create the tunnel in Cloudflare
# 2. Deploy cloudflared pods
# 3. Manage the tunnel configuration
apiVersion: networking.cfargotunnel.com/v1alpha2
kind: ClusterTunnel
metadata:
  name: cto-main
  labels:
    app.kubernetes.io/name: cto-main-tunnel
    app.kubernetes.io/part-of: platform
spec:
  # Cloudflare credentials configuration
  cloudflare:
    # Secret containing CLOUDFLARE_API_TOKEN and CLOUDFLARE_ACCOUNT_ID
    secret: cloudflare-api-credentials
    # Account ID from secret (key name)
    accountId: CLOUDFLARE_ACCOUNT_ID
    # Domain for DNS records
    domain: 5dlabs.ai

  # Create a new tunnel with this name
  newTunnel:
    name: cto-main

  # Fallback for unmatched requests
  fallbackTarget: http_status:404
