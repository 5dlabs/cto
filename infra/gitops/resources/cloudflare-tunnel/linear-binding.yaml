---
# TunnelBinding: Linear Webhooks
# Routes Linear webhook traffic to the Linear service
#
# Traffic flow:
# linear-webhooks.5dlabs.ai/webhooks/linear
#   -> Cloudflare Edge
#   -> cto-main tunnel
#   -> linear-svc:8081
#
# Note: This binding must be in the same namespace as the target service
# because the cloudflare-operator looks up the service by name in the
# TunnelBinding's namespace.
apiVersion: networking.cfargotunnel.com/v1alpha1
kind: TunnelBinding
metadata:
  name: linear-webhooks
  namespace: cto
  labels:
    app.kubernetes.io/name: linear-webhooks
    app.kubernetes.io/part-of: platform
# Note: TunnelBinding v1alpha1 has tunnelRef and subjects at root level, not under spec
tunnelRef:
  kind: ClusterTunnel
  name: cto-main
subjects:
  - name: linear-svc
    spec:
      # Public hostname for Linear webhooks
      fqdn: linear-webhooks.5dlabs.ai
      # Path matching - all webhook paths under /webhooks
      path: /webhooks
      # Target service (must include protocol)
      target: http://linear-svc.cto.svc:8081

