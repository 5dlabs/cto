---
# Test Valkey instance using OT-CONTAINER-KIT Redis Operator
# Valkey is a BSD-3 licensed fork of Redis, fully protocol-compatible
# Using the Redis Operator CRDs with Valkey images for license compliance
# Source: https://valkey.io/
apiVersion: redis.redis.opstreelabs.in/v1beta2
kind: Redis
metadata:
  name: test-valkey
  namespace: databases
  labels:
    app.kubernetes.io/name: test-valkey
    app.kubernetes.io/part-of: platform
    app.kubernetes.io/component: cache
spec:
  # Security context
  podSecurityContext:
    runAsUser: 1000
    fsGroup: 1000

  # Kubernetes configuration - Using Valkey instead of Redis
  # Valkey 7.2 is a direct fork of Redis 7.2.4 and is fully protocol-compatible
  # Note: Valkey 8.0+ introduces new features not in Redis 7.x; use 7.2 for operator compatibility
  kubernetesConfig:
    image: valkey/valkey:7.2-alpine
    imagePullPolicy: IfNotPresent
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

  # Redis exporter works with Valkey (same metrics endpoint)
  redisExporter:
    enabled: false
    image: quay.io/opstree/redis-exporter:v1.44.0

  # Storage configuration
  storage:
    volumeClaimTemplate:
      spec:
        storageClassName: local-path
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 1Gi
