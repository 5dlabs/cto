---
apiVersion: ngrok.k8s.ngrok.com/v1alpha1
kind: NgrokTrafficPolicy
metadata:
  name: security-policy
  namespace: argo
spec:
  policy:
    on_http_request:
      - actions:
          - type: add-headers
            config:
              headers:
                "X-Forwarded-Proto": "https"
                "X-Ngrok-Endpoint": "true"
      - actions:
          - type: rate-limit
            config:
              name: "webhook-rate-limit"
              algorithm: "sliding_window"
              capacity: 600
              rate: "60s"
              bucket_key:
                - "conn.client_ip"
    on_http_response:
      - actions:
          - type: add-headers
            config:
              headers:
                "X-Content-Type-Options": "nosniff"
                "X-Frame-Options": "DENY"
                "X-XSS-Protection": "1; mode=block"
                "Strict-Transport-Security": "max-age=31536000; includeSubDomains"
