[SERVICE]
    Flush           1
    Daemon          Off
    Log_Level       info
    Parsers_File    parsers.conf
    HTTP_Server     On
    HTTP_Listen     0.0.0.0
    HTTP_Port       2020

[INPUT]
    Name              tail
    Tag               kube.*
    Path              /var/log/containers/*.log
    Exclude_Path      /var/log/containers/fluent-bit-*.log
    Parser            cri
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    Refresh_Interval  5

# Enrich with Kubernetes metadata
[FILTER]
    Name                kubernetes
    Match               kube.*
    Kube_URL            https://kubernetes.default.svc:443
    Kube_CA_File        /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    Kube_Token_File     /var/run/secrets/kubernetes.io/serviceaccount/token
    Kube_Tag_Prefix     kube.var.log.containers.
    Merge_Log           On
    Keep_Log            Off
    Labels              On
    Annotations         Off

# Add cluster name
[FILTER]
    Name                modify
    Match               kube.*
    Add                 cluster telemetry-dev

# Send directly to Victoria Logs using HTTP
[OUTPUT]
    Name                http
    Match               kube.*
    Host                victoria-logs-victoria-logs-single-server.telemetry.svc.cluster.local
    Port                9428
    URI                 /insert/jsonline
    Format              json_lines
    Json_date_key       _time
    Json_date_format    iso8601
    Retry_Limit         3

# Keep OTEL output for metrics/traces
[OUTPUT]
    Name                opentelemetry
    Match               kube.*
    Host                otel-collector-opentelemetry-collector.telemetry.svc.cluster.local
    Port                4318
    TLS                 Off
    Logs_uri            /v1/logs
    logs_body_key       log
    logs_resource_metadata_key  kubernetes
