# OpenMemory Configuration
replicaCount: 1

image:
  repository: ghcr.io/5dlabs/openmemory
  pullPolicy: IfNotPresent
  tag: "latest"

nameOverride: ""
fullnameOverride: "openmemory"

service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  annotations: {}

# Database configuration
database:
  # SQLite storage configuration
  storage:
    size: 10Gi
    storageClassName: "longhorn"
    accessMode: ReadWriteOnce
  
  # Database file path inside container
  path: /data/openmemory.db
  
  # Backup configuration
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention: 7  # Keep 7 days of backups

# Embedding configuration
embeddings:
  # Provider: local, openai, cohere, voyage
  provider: "local"
  
  # Model for local embeddings
  localModel: "Xenova/all-MiniLM-L6-v2"
  
  # Dimension settings
  dimensions: 384
  
  # Cache embeddings for performance
  cacheEnabled: true
  cacheSize: 1000

# Memory configuration
memory:
  # Default decay parameters
  decay:
    enabled: true
    lambda: 0.1  # Decay rate
    minSalience: 0.01  # Minimum salience before pruning
  
  # Sector configuration
  sectors:
    - factual
    - emotional
    - temporal
    - relational
    - behavioral
  
  # Waypoint configuration
  waypoints:
    enabled: true
    maxConnections: 10
    similarityThreshold: 0.7

# Agent configuration
agents:
  # List of agents with their configurations
  rex:
    enabled: true
    namespace: "agent/rex"
    queryLimit: 20
    reinforcementMultiplier: 1.5
  
  blaze:
    enabled: true
    namespace: "agent/blaze"
    queryLimit: 20
    reinforcementMultiplier: 1.5
  
  cleo:
    enabled: true
    namespace: "agent/cleo"
    queryLimit: 15
    reinforcementMultiplier: 1.2
  
  tess:
    enabled: true
    namespace: "agent/tess"
    queryLimit: 25
    reinforcementMultiplier: 2.0
  
  atlas:
    enabled: true
    namespace: "agent/atlas"
    queryLimit: 10
    reinforcementMultiplier: 1.0
  
  morgan:
    enabled: true
    namespace: "agent/morgan"
    queryLimit: 10
    reinforcementMultiplier: 1.0
  
  bolt:
    enabled: true
    namespace: "agent/bolt"
    queryLimit: 15
    reinforcementMultiplier: 1.3
  
  cipher:
    enabled: true
    namespace: "agent/cipher"
    queryLimit: 20
    reinforcementMultiplier: 1.8

# API configuration
api:
  # Rate limiting
  rateLimit:
    enabled: true
    windowMs: 60000  # 1 minute
    maxRequests: 1000
  
  # CORS settings
  cors:
    enabled: true
    origins:
      - "http://localhost:*"
      - "https://*.5dlabs.io"
  
  # Authentication
  auth:
    enabled: false  # Start without auth for testing
    type: "bearer"
    tokens: []

# Performance tuning
performance:
  # Query optimization
  queryTimeout: 5000  # ms
  maxConcurrentQueries: 100
  
  # Cache settings
  resultCacheEnabled: true
  resultCacheTTL: 300  # seconds
  
  # Connection pooling
  maxConnections: 20
  connectionTimeout: 10000  # ms

# Monitoring
monitoring:
  enabled: true
  
  # Prometheus metrics
  metrics:
    enabled: true
    port: 9090
    path: /metrics
  
  # Health checks
  healthCheck:
    enabled: true
    path: /health
    intervalSeconds: 30
    timeoutSeconds: 5

# Resources
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi

nodeSelector: {}

tolerations: []

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - openmemory
        topologyKey: kubernetes.io/hostname

# Security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false  # SQLite needs write access
  allowPrivilegeEscalation: false

# Persistence
persistence:
  enabled: true
  existingClaim: ""
  annotations: {}
  
# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Ingress (optional)
ingress:
  enabled: false
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: memory.5dlabs.io
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: openmemory-tls
      hosts:
        - memory.5dlabs.io
