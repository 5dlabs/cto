---
# OpenBao Configuration for Kind Cluster
# Open source fork of HashiCorp Vault (MPL 2.0 license)
# See: https://openbao.org/docs/platform/k8s/helm/

global:
  enabled: true
  tlsDisable: true  # Internal cluster only

server:
  image:
    registry: "quay.io"
    repository: "openbao/openbao"
    tag: "2.4.4"  # Latest stable
    pullPolicy: IfNotPresent

  # Standalone mode configuration
  standalone:
    enabled: true
    config: |
      ui = true

      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }

      storage "raft" {
        path = "/openbao/data"
      }

      service_registration "kubernetes" {}

  # Persistent storage for Raft backend
  dataStorage:
    enabled: true
    size: 5Gi
    storageClass: "standard"  # Kind default
    accessMode: ReadWriteOnce

  # Resource limits
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

  # Enable auth delegator for Kubernetes auth method
  authDelegator:
    enabled: true

  # Service account configuration
  serviceAccount:
    create: true

  # Readiness probe - allow sealed state during init
  readinessProbe:
    enabled: true
    path: "/v1/sys/health?standbyok=true&sealedcode=204&uninitcode=204"

  # Service configuration
  service:
    enabled: true
    port: 8200
    targetPort: 8200

  # Affinity - allow deployment on single node cluster (Kind)
  affinity: ""

# OpenBao UI
ui:
  enabled: true
  serviceType: ClusterIP
  externalPort: 8200
  targetPort: 8200

# Disable injector - can use OpenBao Secrets Operator later
injector:
  enabled: false

# Disable CSI driver
csi:
  enabled: false

