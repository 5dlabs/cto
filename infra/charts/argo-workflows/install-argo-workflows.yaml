---
# Argo Workflows Installation via Helm Chart
# This file contains the Helm values for installing Argo Workflows
#
# Install command:
# helm repo add argo https://argoproj.github.io/argo-helm
# helm repo update
# helm install argo-workflows argo/argo-workflows --namespace argo --create-namespace -f install-argo-workflows.yaml

# Global Configuration
useDefaultArtifactRepo: true
useStaticCredentials: true

# Workflow Controller Configuration
controller:
  # Enable workflow controller metrics
  metrics:
    enabled: true
    serviceMonitor:
      enabled: false  # Enable if you have Prometheus operator
  
  # Workflow controller configuration
  workflowNamespaces:
    - argo
    - orchestrator
    - default
  
  # Disable persistence for testing (use archive for production)
  persistence: {}
  
  # Resource limits
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 8737

# Server Configuration
server:
  enabled: true
  
  # Enable secure mode with proper authentication
  extraArgs:
    - --auth-mode=server
    - --secure=false  # TODO: Enable TLS for production
  
  service:
    type: NodePort
    nodePort: 30081
  
  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  
  # RBAC for server
  serviceAccount:
    create: true
    name: argo-workflows-server

# Workflow executor configuration
executor:
  # Use emissary executor for better security
  image:
    tag: v3.5.2
  
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Artifact Repository (for storing workflow artifacts)
artifactRepository:
  # Use filesystem for simplicity
  archiveLogs: true
  filesystem:
    path: /tmp/argo-artifacts

# Custom artifact repository reference (optional)
# artifactRepositoryRef:
#   configMap: artifact-repositories
#   key: default-v1

# Workflow defaults
workflowDefaults:
  spec:
    # Default service account for workflows
    serviceAccountName: argo-workflow
    
    # Default artifact repository
    artifactRepositoryRef:
      configMap: artifact-repositories
      key: default-v1
    
    # Security context for workflow pods
    securityContext:
      runAsNonRoot: true
      runAsUser: 8737
    
    # Default tolerations and node selectors
    tolerations: []
    nodeSelector: {}
    
    # Default resource limits for workflow steps
    podSpecPatch: |
      containers:
      - name: main
        resources:
          limits:
            cpu: 1000m
            memory: 1Gi
          requests:
            cpu: 100m
            memory: 128Mi

# Workflow RBAC
workflow:
  serviceAccount:
    create: true
    name: argo-workflow
    annotations: {}
  
  rbac:
    create: true