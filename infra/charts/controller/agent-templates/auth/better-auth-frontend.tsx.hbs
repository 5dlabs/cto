// auth-client.tsx - BetterAuth Frontend Configuration
// Agent: Blaze (Frontend)
// Generated for: {{project_name}}

import { createAuthClient } from "better-auth/client"
{{#if use_react}}
import { BetterAuthProvider, useAuth } from "@better-auth/react"
{{/if}}
{{#if use_vue}}
import { createAuthPlugin } from "@better-auth/vue"
{{/if}}
{{#if use_solid}}
import { createAuthContext } from "@better-auth/solid"
{{/if}}
{{#if use_2fa}}
import { twoFactorClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_magic_link}}
import { magicLinkClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_passkey}}
import { passkeyClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_organization}}
import { organizationClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_admin}}
import { adminClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_multi_session}}
import { multiSessionClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_anonymous}}
import { anonymousClient } from "better-auth/client/plugins"
{{/if}}
{{#if use_oidc_provider}}
import { oidcClient } from "better-auth/client/plugins"
{{/if}}

// Create auth client
export const authClient = createAuthClient({
  baseURL: process.env.NEXT_PUBLIC_AUTH_URL || "http://localhost:3000",
  
  // Client configuration
  fetchOptions: {
    credentials: "include",
    {{#if custom_headers}}
    headers: {
      {{#each custom_headers}}
      "{{this.key}}": "{{this.value}}",
      {{/each}}
    }
    {{/if}}
  },
  
  // Plugins
  plugins: [
    {{#if use_2fa}}
    twoFactorClient(),
    {{/if}}
    {{#if use_magic_link}}
    magicLinkClient(),
    {{/if}}
    {{#if use_passkey}}
    passkeyClient({
      authenticationTimeout: 60000 // 60 seconds
    }),
    {{/if}}
    {{#if use_organization}}
    organizationClient(),
    {{/if}}
    {{#if use_admin}}
    adminClient(),
    {{/if}}
    {{#if use_multi_session}}
    multiSessionClient(),
    {{/if}}
    {{#if use_anonymous}}
    anonymousClient(),
    {{/if}}
    {{#if use_oidc_provider}}
    oidcClient(),
    {{/if}}
  ]
})

{{#if use_react}}
// React Provider Component
export function AuthProvider({ children }: { children: React.ReactNode }) {
  return (
    <BetterAuthProvider client={authClient}>
      {children}
    </BetterAuthProvider>
  )
}

// Custom hooks for common auth operations
export function useSession() {
  const { data: session, isPending, error } = authClient.useSession()
  return {
    session,
    user: session?.user,
    isLoading: isPending,
    error
  }
}

export function useRequireAuth(redirectTo = "/sign-in") {
  const { user, isLoading } = useSession()
  
  React.useEffect(() => {
    if (!isLoading && !user) {
      window.location.href = redirectTo
    }
  }, [user, isLoading, redirectTo])
  
  return { user, isLoading }
}

{{#if use_organization}}
export function useOrganization() {
  const { data: organization, isPending, error } = authClient.useActiveOrganization()
  const organizations = authClient.useListOrganizations()
  
  return {
    activeOrganization: organization,
    organizations: organizations.data,
    isLoading: isPending || organizations.isPending,
    error: error || organizations.error,
    switchOrganization: authClient.organization.setActive,
    createOrganization: authClient.organization.create,
    inviteMember: authClient.organization.inviteMember
  }
}
{{/if}}
{{/if}}

// Authentication Components with shadcn/ui

{{#if use_react}}
// Login Form Component
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card"
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form"
import { Separator } from "@/components/ui/separator"
import { Icons } from "@/components/icons"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import * as z from "zod"
import { useState } from "react"
import { useRouter } from "next/navigation"
import { toast } from "sonner"

const loginSchema = z.object({
  email: z.string().email("Invalid email address"),
  password: z.string().min(8, "Password must be at least 8 characters")
})

export function LoginForm() {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(false)
  
  const form = useForm<z.infer<typeof loginSchema>>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      email: "",
      password: ""
    }
  })
  
  async function onSubmit(values: z.infer<typeof loginSchema>) {
    setIsLoading(true)
    
    try {
      const { data, error } = await authClient.signIn.email({
        email: values.email,
        password: values.password
      })
      
      if (error) {
        toast.error(error.message || "Authentication failed")
      } else {
        toast.success("Welcome back!")
        router.push("/dashboard")
      }
    } catch (error) {
      toast.error("An unexpected error occurred")
    } finally {
      setIsLoading(false)
    }
  }
  
  return (
    <Card className="w-full max-w-md">
      <CardHeader className="space-y-1">
        <CardTitle className="text-2xl font-bold">Sign in</CardTitle>
        <CardDescription>
          Enter your email and password to sign in to your account
        </CardDescription>
      </CardHeader>
      <CardContent>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="email"
                      placeholder="you@example.com"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Password</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="password"
                      placeholder="••••••••"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <div className="flex items-center justify-between">
              <a
                href="/forgot-password"
                className="text-sm text-muted-foreground hover:text-primary"
              >
                Forgot password?
              </a>
            </div>
            
            <Button
              type="submit"
              className="w-full"
              disabled={isLoading}
            >
              {isLoading && <Icons.spinner className="mr-2 h-4 w-4 animate-spin" />}
              Sign In
            </Button>
          </form>
        </Form>
        
        {{#if social_providers}}
        <div className="relative my-4">
          <Separator />
          <span className="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 bg-background px-2 text-xs text-muted-foreground">
            Or continue with
          </span>
        </div>
        
        <div className="grid gap-2">
          {{#if github_auth}}
          <Button
            variant="outline"
            onClick={() => authClient.signIn.social({ provider: "github" })}
            disabled={isLoading}
          >
            <Icons.gitHub className="mr-2 h-4 w-4" />
            GitHub
          </Button>
          {{/if}}
          {{#if google_auth}}
          <Button
            variant="outline"
            onClick={() => authClient.signIn.social({ provider: "google" })}
            disabled={isLoading}
          >
            <Icons.google className="mr-2 h-4 w-4" />
            Google
          </Button>
          {{/if}}
        </div>
        {{/if}}
        
        {{#if use_magic_link}}
        <div className="relative my-4">
          <Separator />
          <span className="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 bg-background px-2 text-xs text-muted-foreground">
            Or
          </span>
        </div>
        
        <Button
          variant="outline"
          className="w-full"
          onClick={() => router.push("/sign-in/magic-link")}
          disabled={isLoading}
        >
          <Icons.mail className="mr-2 h-4 w-4" />
          Sign in with Magic Link
        </Button>
        {{/if}}
      </CardContent>
      <CardFooter>
        <p className="text-sm text-muted-foreground">
          Don't have an account?{" "}
          <a href="/sign-up" className="font-medium text-primary hover:underline">
            Sign up
          </a>
        </p>
      </CardFooter>
    </Card>
  )
}

// Sign Up Form Component
const signUpSchema = z.object({
  email: z.string().email("Invalid email address"),
  password: z.string().min(8, "Password must be at least 8 characters"),
  confirmPassword: z.string(),
  name: z.string().min(2, "Name must be at least 2 characters"),
  {{#if custom_signup_fields}}
  {{#each custom_signup_fields}}
  {{this.name}}: z.{{this.validation}}(),
  {{/each}}
  {{/if}}
}).refine((data) => data.password === data.confirmPassword, {
  message: "Passwords don't match",
  path: ["confirmPassword"]
})

export function SignUpForm() {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(false)
  
  const form = useForm<z.infer<typeof signUpSchema>>({
    resolver: zodResolver(signUpSchema),
    defaultValues: {
      email: "",
      password: "",
      confirmPassword: "",
      name: ""
    }
  })
  
  async function onSubmit(values: z.infer<typeof signUpSchema>) {
    setIsLoading(true)
    
    try {
      const { data, error } = await authClient.signUp.email({
        email: values.email,
        password: values.password,
        name: values.name,
        {{#if custom_signup_fields}}
        data: {
          {{#each custom_signup_fields}}
          {{this.name}}: values.{{this.name}},
          {{/each}}
        }
        {{/if}}
      })
      
      if (error) {
        toast.error(error.message || "Sign up failed")
      } else {
        toast.success("Account created successfully!")
        {{#if require_email_verification}}
        toast.info("Please check your email to verify your account")
        router.push("/verify-email")
        {{else}}
        router.push("/dashboard")
        {{/if}}
      }
    } catch (error) {
      toast.error("An unexpected error occurred")
    } finally {
      setIsLoading(false)
    }
  }
  
  return (
    <Card className="w-full max-w-md">
      <CardHeader className="space-y-1">
        <CardTitle className="text-2xl font-bold">Create an account</CardTitle>
        <CardDescription>
          Enter your information to create your account
        </CardDescription>
      </CardHeader>
      <CardContent>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Name</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      placeholder="John Doe"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="email"
                      placeholder="you@example.com"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Password</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="password"
                      placeholder="••••••••"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            <FormField
              control={form.control}
              name="confirmPassword"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Confirm Password</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="password"
                      placeholder="••••••••"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            
            {{#if custom_signup_fields}}
            {{#each custom_signup_fields}}
            <FormField
              control={form.control}
              name="{{this.name}}"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>{{this.label}}</FormLabel>
                  <FormControl>
                    <Input
                      {...field}
                      type="{{this.type}}"
                      placeholder="{{this.placeholder}}"
                      disabled={isLoading}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
            {{/each}}
            {{/if}}
            
            <Button
              type="submit"
              className="w-full"
              disabled={isLoading}
            >
              {isLoading && <Icons.spinner className="mr-2 h-4 w-4 animate-spin" />}
              Create Account
            </Button>
          </form>
        </Form>
        
        {{#if social_providers}}
        <div className="relative my-4">
          <Separator />
          <span className="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 bg-background px-2 text-xs text-muted-foreground">
            Or sign up with
          </span>
        </div>
        
        <div className="grid gap-2">
          {{#if github_auth}}
          <Button
            variant="outline"
            onClick={() => authClient.signIn.social({ provider: "github", callbackURL: "/onboarding" })}
            disabled={isLoading}
          >
            <Icons.gitHub className="mr-2 h-4 w-4" />
            GitHub
          </Button>
          {{/if}}
          {{#if google_auth}}
          <Button
            variant="outline"
            onClick={() => authClient.signIn.social({ provider: "google", callbackURL: "/onboarding" })}
            disabled={isLoading}
          >
            <Icons.google className="mr-2 h-4 w-4" />
            Google
          </Button>
          {{/if}}
        </div>
        {{/if}}
      </CardContent>
      <CardFooter>
        <p className="text-sm text-muted-foreground">
          Already have an account?{" "}
          <a href="/sign-in" className="font-medium text-primary hover:underline">
            Sign in
          </a>
        </p>
      </CardFooter>
    </Card>
  )
}

// User Profile Component
export function UserProfile() {
  const { user, isLoading } = useSession()
  const [isUpdating, setIsUpdating] = useState(false)
  
  if (isLoading) {
    return <div>Loading...</div>
  }
  
  if (!user) {
    return null
  }
  
  async function handleSignOut() {
    await authClient.signOut()
    window.location.href = "/sign-in"
  }
  
  return (
    <Card className="w-full max-w-md">
      <CardHeader>
        <CardTitle>Profile</CardTitle>
        <CardDescription>Manage your account settings</CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        <div>
          <Label>Name</Label>
          <p className="text-sm">{user.name}</p>
        </div>
        <div>
          <Label>Email</Label>
          <p className="text-sm">{user.email}</p>
        </div>
        {{#if use_2fa}}
        <div>
          <Label>Two-Factor Authentication</Label>
          <p className="text-sm">
            {user.twoFactorEnabled ? "Enabled" : "Disabled"}
          </p>
        </div>
        {{/if}}
      </CardContent>
      <CardFooter className="flex justify-between">
        <Button variant="outline" onClick={handleSignOut}>
          Sign Out
        </Button>
        <Button onClick={() => router.push("/settings")}>
          Edit Profile
        </Button>
      </CardFooter>
    </Card>
  )
}
{{/if}}

// Export auth operations for use in server components
export const signIn = authClient.signIn
export const signUp = authClient.signUp
export const signOut = authClient.signOut
export const getSession = authClient.getSession

{{#if use_organization}}
export const organization = authClient.organization
{{/if}}
{{#if use_2fa}}
export const twoFactor = authClient.twoFactor
{{/if}}
{{#if use_passkey}}
export const passkey = authClient.passkey
{{/if}}
{{#if use_magic_link}}
export const magicLink = authClient.magicLink
{{/if}}
