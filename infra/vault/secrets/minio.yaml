---
# =============================================================================
# MinIO Screenshot Storage Secrets
# =============================================================================
# These VaultStaticSecrets sync MinIO credentials from Vault to Kubernetes.
#
# REQUIRED: Populate these secrets in Vault before deploying:
#
# 1. MinIO root credentials (used by tenant):
#    vault kv put secret/minio-screenshots-credentials \
#      config.env="$(cat <<'EOF'
# export MINIO_ROOT_USER=minio-admin
# export MINIO_ROOT_PASSWORD=$(openssl rand -base64 32)
# EOF
# )"
#
# 2. MinIO access keys for tools server (S3 client credentials):
#    vault kv put secret/tools-minio \
#      MINIO_ENDPOINT=http://minio.minio-screenshots.svc.cluster.local:80 \
#      MINIO_ACCESS_KEY=screenshots-uploader \
#      MINIO_SECRET_KEY=$(openssl rand -base64 32) \
#      MINIO_BUCKET=screenshots \
#      MINIO_REGION=us-east-1
#
# After deploying MinIO, create the access key:
#    kubectl port-forward svc/screenshots-console -n minio-screenshots 9090:9090
#    # Login with root credentials, create 'screenshots-uploader' access key
#    # Update Vault with the generated key pair
#
# =============================================================================

---
# MinIO Tenant Credentials - minio-screenshots namespace
# This secret is required by the MinIO tenant for root user authentication
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: minio-screenshots-credentials
  namespace: minio-screenshots
  labels:
    app.kubernetes.io/name: minio-screenshots-credentials
    app.kubernetes.io/part-of: platform
spec:
  vaultAuthRef: infra/vault-auth
  mount: secret
  path: minio-screenshots-credentials
  type: kv-v2
  refreshAfter: 30s
  destination:
    create: true
    name: minio-screenshots-credentials

---
# MinIO Client Credentials - cto namespace
# Used by tools server and agents to upload screenshots
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: tools-minio-secrets
  namespace: cto
  labels:
    app.kubernetes.io/name: tools-minio-secrets
    app.kubernetes.io/part-of: platform
spec:
  vaultAuthRef: infra/vault-auth
  mount: secret
  path: tools-minio
  type: kv-v2
  refreshAfter: 30s
  destination:
    create: true
    name: tools-minio-secrets

