---
# =============================================================================
# CTO Platform Linear Integration Secrets
# =============================================================================
# VaultStaticSecret syncs Linear OAuth and webhook secrets from Vault to Kubernetes.
#
# REQUIRED: Register a Linear OAuth Application with Agent capabilities:
#   https://linear.app/settings/api/applications
#
# OAuth Application Setup:
# 1. Create a new OAuth application in Linear
# 2. Enable "Agent Session Events" webhook category
# 3. Set callback URL: https://linear-webhooks.5dlabs.ai/oauth/callback
# 4. Set webhook URL: https://linear-webhooks.5dlabs.ai/webhooks/linear
# 5. Copy the client ID, client secret, and webhook signing secret
#
# Populate secrets in Vault:
#    vault kv put secret/cto/linear \
#      oauth_client_id="<client-id>" \
#      oauth_client_secret="<client-secret>" \
#      access_token="<oauth-access-token>" \
#      webhook_secret="<webhook-signing-secret>"
#
# Note: The access_token is obtained after OAuth authorization flow.
# For server-to-server, use Linear's actor token flow.
#
# =============================================================================

---
# CTO Linear Secrets - cto namespace
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: cto-linear-secrets
  namespace: cto
  labels:
    app.kubernetes.io/name: cto-linear-secrets
    app.kubernetes.io/part-of: platform
spec:
  vaultAuthRef: infra/vault-auth
  mount: secret
  path: cto/linear
  type: kv-v2
  refreshAfter: 30s
  destination:
    create: true
    name: linear-secrets
    transformation:
      excludeRaw: true
      templates:
        LINEAR_OAUTH_CLIENT_ID:
          text: "{{ .Secrets.oauth_client_id }}"
        LINEAR_OAUTH_CLIENT_SECRET:
          text: "{{ .Secrets.oauth_client_secret }}"
        LINEAR_OAUTH_TOKEN:
          text: "{{ .Secrets.access_token }}"
        LINEAR_WEBHOOK_SECRET:
          text: "{{ .Secrets.webhook_secret }}"



