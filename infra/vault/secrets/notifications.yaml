---
# =============================================================================
# CTO Platform Notification Secrets
# =============================================================================
# VaultStaticSecret syncs notification webhook URLs from Vault to Kubernetes.
#
# REQUIRED: Populate these secrets in Vault before notifications will work:
#
# 1. Discord webhook URL:
#    vault kv put secret/cto/notifications \
#      discord_webhook_url="https://discord.com/api/webhooks/..."
#
# Note: The webhook URL is obtained by creating a webhook in Discord:
#   Server Settings > Integrations > Webhooks > New Webhook
#
# =============================================================================

---
# CTO Notifications Secrets - cto namespace
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: cto-notifications-secrets
  namespace: cto
  labels:
    app.kubernetes.io/name: cto-notifications-secrets
    app.kubernetes.io/part-of: platform
spec:
  vaultAuthRef: infra/vault-auth
  mount: secret
  path: cto/notifications
  type: kv-v2
  refreshAfter: 30s
  destination:
    create: true
    name: cto-notifications-secrets
    transformation:
      excludeRaw: true
      templates:
        DISCORD_WEBHOOK_URL:
          text: "{{ .Secrets.discord_webhook_url }}"



