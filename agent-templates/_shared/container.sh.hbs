{{> header }}

{{> node-env }}

{{> expo-env }}

{{> config }}

{{> github-auth }}

{{> git-setup }}

{{> task-files }}

{{> acceptance-probe }}

# =========================================================================
# CLI Execution
# The Rust adapter injects the CLI-specific invocation here
# =========================================================================

echo ""
echo "════════════════════════════════════════════════════════════════"
echo "║ Executing {{cli_type}} CLI (Attempt ${CURRENT_ATTEMPT:-1} of ${EXECUTION_MAX_RETRIES:-{{default_retries}}})"
echo "════════════════════════════════════════════════════════════════"
echo ""

{{cli_execute}}
CLI_EXIT_CODE=$?

# =========================================================================
# Post-Execution Verification
# =========================================================================

if [ $CLI_EXIT_CODE -eq 0 ]; then
    echo ""
    echo "✓ CLI execution completed successfully"
    
    # Run acceptance criteria probe
    if type probe_acceptance_criteria >/dev/null 2>&1; then
        probe_acceptance_criteria
        PROBE_RESULT=$?
        
        if [ $PROBE_RESULT -ne 0 ]; then
            echo ""
            echo "⚠️ Acceptance criteria not fully met"
            echo "   Controller will evaluate retry based on policy"
        fi
    fi
else
    echo ""
    echo "❌ CLI execution failed with exit code: $CLI_EXIT_CODE"
fi

{{> completion }}
