---
# OpenMemory Server - Kind Local Values
# Based on: infra/gitops/applications/openmemory.yaml

replicaCount: 1

# Operation tier: hybrid, local, or cloud
tier: "hybrid"

image:
  repository: ghcr.io/5dlabs/openmemory
  pullPolicy: IfNotPresent
  tag: "kind-local"

fullnameOverride: "openmemory"

service:
  type: ClusterIP
  port: 8080
  targetPort: 8080

# Database configuration
database:
  storage:
    size: 10Gi
    storageClassName: "standard"
    accessMode: ReadWriteOnce
  
  path: /data/openmemory.db
  
  backup:
    enabled: false  # Disabled for local development

# Embedding configuration
embeddings:
  provider: "local"
  localModel: "Xenova/all-MiniLM-L6-v2"
  dimensions: 384
  cacheEnabled: true
  cacheSize: 1000

# Memory configuration
memory:
  tier: "hybrid"
  decay:
    enabled: true
    lambda: 0.1
    minSalience: 0.01
  sectors:
    - factual
    - emotional
    - temporal
    - relational
    - behavioral
  waypoints:
    enabled: true
    maxConnections: 10
    similarityThreshold: 0.7

# Agent configuration
agents:
  rex:
    enabled: true
    namespace: "agent/rex"
    queryLimit: 20
    reinforcementMultiplier: 1.5
  
  blaze:
    enabled: true
    namespace: "agent/blaze"
    queryLimit: 20
    reinforcementMultiplier: 1.5
  
  cleo:
    enabled: true
    namespace: "agent/cleo"
    queryLimit: 15
    reinforcementMultiplier: 1.2
  
  tess:
    enabled: true
    namespace: "agent/tess"
    queryLimit: 25
    reinforcementMultiplier: 2.0
  
  morgan:
    enabled: true
    namespace: "agent/morgan"
    queryLimit: 10
    reinforcementMultiplier: 1.0
  
  healer:
    enabled: true
    namespace: "agent/healer"
    queryLimit: 50
    reinforcementMultiplier: 2.0
    categories:
      - ci-failures
      - agent-performance
      - routing-decisions
      - escalations

# API configuration
api:
  rateLimit:
    enabled: true
    windowMs: 60000
    maxRequests: 2000  # Higher limit for multi-agent usage
  cors:
    enabled: true
    origins:
      - "http://localhost:*"
  auth:
    enabled: false  # Disabled for local development

# Performance tuning
performance:
  queryTimeout: 5000
  maxConcurrentQueries: 100
  resultCacheEnabled: true
  resultCacheTTL: 300
  maxConnections: 20
  connectionTimeout: 10000

# Monitoring
monitoring:
  enabled: true
  metrics:
    enabled: true
    port: 9090
    path: /metrics
  healthCheck:
    enabled: true
    path: /health
    intervalSeconds: 30
    timeoutSeconds: 5

# Resources (reduced for local development)
resources:
  limits:
    cpu: 1000m
    memory: 2Gi
  requests:
    cpu: 200m
    memory: 512Mi

nodeSelector: {}
tolerations: []
affinity: {}

# Security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false  # SQLite needs write access
  allowPrivilegeEscalation: false

# Persistence
persistence:
  enabled: true
  existingClaim: ""

# Service Account
serviceAccount:
  create: true
  name: ""

# Ingress disabled for local
ingress:
  enabled: false

