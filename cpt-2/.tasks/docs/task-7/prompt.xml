<?xml version="1.0" encoding="UTF-8"?>
<task id="7" priority="high" agent="cipher">
    <meta>
        <title>Create authentication middleware</title>
        <priority>high</priority>
        <dependencies>5</dependencies>
        <agent_hint>cipher</agent_hint>
    </meta>

    <role>You are a Senior Security Engineer with expertise in authentication and secure coding. Implement Task 7 with production-quality code.</role>

    <context>
        <overview>Implement middleware to verify JWT tokens and protect routes</overview>
        <background>Review PRD and architecture in .tasks/docs/ for full context.</background>
    </context>

    <requirements>
        <description>1. Create authenticateToken middleware
2. Extract token from Authorization header
3. Verify token and attach user to request object
4. Handle token expiration and invalid tokens
5. Create optional authentication middleware for public routes</description>
        <constraints>
            <constraint>Match existing codebase patterns</constraint>
            <constraint>Create PR with atomic commits</constraint>
            <constraint>Include unit tests</constraint>
            <constraint>PR title: feat(task-7): Create authentication middleware</constraint>
        </constraints>
    </requirements>

    <acceptance_criteria>
        <criterion>All requirements implemented</criterion>
        <criterion>Tests passing with adequate coverage</criterion>
        <criterion>Code follows project conventions</criterion>
        <criterion>Test middleware correctly authenticates valid tokens and rejects invalid ones</criterion>
    </acceptance_criteria>

    <validation>
        <command>cargo test (Rust)</command>
        <command>cargo clippy -- -D warnings (Rust)</command>
        <command>go test ./... (Go)</command>
        <command>npm test (Node.js)</command>
    </validation>

    <deliverables>
        <deliverable>Working implementation</deliverable>
        <deliverable>Unit tests</deliverable>
        <deliverable>Pull request</deliverable>
    </deliverables>
</task>
