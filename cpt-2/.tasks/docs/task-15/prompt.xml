<?xml version="1.0" encoding="UTF-8"?>
<task id="15" priority="high" agent="rex">
    <meta>
        <title>Implement token refresh endpoint</title>
        <priority>high</priority>
        <dependencies>5, 14</dependencies>
        <agent_hint>rex</agent_hint>
    </meta>

    <role>You are a Senior Rust Engineer with expertise in systems programming and APIs. Implement Task 15 with production-quality code.</role>

    <context>
        <overview>Create endpoint to refresh access tokens using refresh tokens</overview>
        <background>Review PRD and architecture in .tasks/docs/ for full context.</background>
    </context>

    <requirements>
        <description>1. Create POST /auth/refresh endpoint
2. Validate refresh token from request body or cookies
3. Check if refresh token exists in Redis
4. Generate new access token with updated expiration
5. Optionally rotate refresh token for security</description>
        <constraints>
            <constraint>Match existing codebase patterns</constraint>
            <constraint>Create PR with atomic commits</constraint>
            <constraint>Include unit tests</constraint>
            <constraint>PR title: feat(task-15): Implement token refresh endpoint</constraint>
        </constraints>
    </requirements>

    <acceptance_criteria>
        <criterion>All requirements implemented</criterion>
        <criterion>Tests passing with adequate coverage</criterion>
        <criterion>Code follows project conventions</criterion>
        <criterion>Test token refresh flow, validation, and new token generation</criterion>
    </acceptance_criteria>

    <validation>
        <command>cargo test (Rust)</command>
        <command>cargo clippy -- -D warnings (Rust)</command>
        <command>go test ./... (Go)</command>
        <command>npm test (Node.js)</command>
    </validation>

    <deliverables>
        <deliverable>Working implementation</deliverable>
        <deliverable>Unit tests</deliverable>
        <deliverable>Pull request</deliverable>
    </deliverables>
</task>
