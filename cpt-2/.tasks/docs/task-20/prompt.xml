<?xml version="1.0" encoding="UTF-8"?>
<task id="20" priority="low" agent="cipher">
    <meta>
        <title>Implement account linking functionality</title>
        <priority>low</priority>
        <dependencies>10, 19</dependencies>
        <agent_hint>cipher</agent_hint>
    </meta>

    <role>You are a Senior Security Engineer with expertise in authentication and secure coding. Implement Task 20 with production-quality code.</role>

    <context>
        <overview>Allow users to link multiple OAuth providers to single account</overview>
        <background>Review PRD and architecture in .tasks/docs/ for full context.</background>
    </context>

    <requirements>
        <description>1. Create POST /auth/link/:provider endpoint
2. Check if user is already authenticated
3. Initiate OAuth flow for additional provider
4. Link new provider to existing user account
5. Handle conflicts when provider account already linked</description>
        <constraints>
            <constraint>Match existing codebase patterns</constraint>
            <constraint>Create PR with atomic commits</constraint>
            <constraint>Include unit tests</constraint>
            <constraint>PR title: feat(task-20): Implement account linking functionality</constraint>
        </constraints>
    </requirements>

    <acceptance_criteria>
        <criterion>All requirements implemented</criterion>
        <criterion>Tests passing with adequate coverage</criterion>
        <criterion>Code follows project conventions</criterion>
        <criterion>Test provider linking, conflict resolution, and account merging</criterion>
    </acceptance_criteria>

    <validation>
        <command>cargo test (Rust)</command>
        <command>cargo clippy -- -D warnings (Rust)</command>
        <command>go test ./... (Go)</command>
        <command>npm test (Node.js)</command>
    </validation>

    <deliverables>
        <deliverable>Working implementation</deliverable>
        <deliverable>Unit tests</deliverable>
        <deliverable>Pull request</deliverable>
    </deliverables>
</task>
