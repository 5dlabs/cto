<?xml version="1.0" encoding="UTF-8"?>
<task id="21" priority="medium" agent="cipher">
    <meta>
        <title>Setup email service configuration</title>
        <priority>medium</priority>
        <dependencies>2</dependencies>
        <agent_hint>cipher</agent_hint>
    </meta>

    <role>You are a Senior Security Engineer with expertise in authentication and secure coding. Implement Task 21 with production-quality code.</role>

    <context>
        <overview>Configure email service for sending authentication emails</overview>
        <background>Review PRD and architecture in .tasks/docs/ for full context.</background>
    </context>

    <requirements>
        <description>1. Configure nodemailer with SMTP settings
2. Create email templates for verification and password reset
3. Implement email queue for reliable delivery
4. Add email sending error handling and retries
5. Setup email rate limiting per user</description>
        <constraints>
            <constraint>Match existing codebase patterns</constraint>
            <constraint>Create PR with atomic commits</constraint>
            <constraint>Include unit tests</constraint>
            <constraint>PR title: feat(task-21): Setup email service configuration</constraint>
        </constraints>
    </requirements>

    <acceptance_criteria>
        <criterion>All requirements implemented</criterion>
        <criterion>Tests passing with adequate coverage</criterion>
        <criterion>Code follows project conventions</criterion>
        <criterion>Test email sending, template rendering, and error handling</criterion>
    </acceptance_criteria>

    <validation>
        <command>cargo test (Rust)</command>
        <command>cargo clippy -- -D warnings (Rust)</command>
        <command>go test ./... (Go)</command>
        <command>npm test (Node.js)</command>
    </validation>

    <deliverables>
        <deliverable>Working implementation</deliverable>
        <deliverable>Unit tests</deliverable>
        <deliverable>Pull request</deliverable>
    </deliverables>
</task>
