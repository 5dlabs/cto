<div align="center">

<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/5dlabs-logo-dark.svg" alt="5D Labs Logo" width="400px">

# **Cognitive Task Orchestrator**
## **GitOps for AI Agents - Where Code Ships Itself** ‚ö°

[![GitHub Stars](https://img.shields.io/github/stars/5dlabs/cto?style=for-the-badge&logo=github&logoColor=white&labelColor=24292e&color=0969da)](https://github.com/5dlabs/cto)
[![Discord](https://img.shields.io/badge/Discord-5dlabs.ai-5865F2?style=for-the-badge&logo=discord&logoColor=white)](https://discord.gg/A6yydvjZKY)
[![License](https://img.shields.io/badge/License-AGPL--3.0-blue?style=for-the-badge&logo=gnu&logoColor=white)](LICENSE)
[![Kubernetes](https://img.shields.io/badge/Kubernetes-1.19+-326CE5?style=for-the-badge&logo=kubernetes&logoColor=white)](https://kubernetes.io/)

### **üíé Production-Ready AI Development Platform - MCP Protocol Native üíé**
*Deploy autonomous AI agents with your choice of CLI that ship production code via GitHub PRs*

</div>

---

<div align="center">

## **üöß Development Status**

**This project is under active development.** We're working towards a public release that will be available for general use by the end of Q3 2024 (September 2024). The platform is currently in beta and being refined based on internal usage and feedback.

**Current Status:**
‚úÖ Core platform architecture implemented
‚úÖ MCP server integration working
‚úÖ Kubernetes controllers operational
‚úÖ GitHub Apps authentication system
üîÑ Documentation and user experience improvements
üîÑ Public release preparation

</div>

---

<div align="center">

## **Meet Your AI Development Dream Team**

*Eight specialized agents with distinct personalities working together 24/7*

<div align="center">

### **üéØ Project Management & Architecture**

<table>
<tr>
<td align="center" width="100%">

### **Morgan**
#### *The Overseer*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/morgan-avatar.png" width="180" height="180" alt="Morgan Avatar">
</div>

‚úçÔ∏è **Personality:** Articulate & organized  
üìñ **Superpower:** Explains complex things simply  
üí¨ **Motto:** *"Knowledge shared is knowledge squared!"*

**Morgan oversees project architecture, generates comprehensive documentation, and manages GitHub projects via `docs()` MCP calls, creating the foundation for all development work.**

</td>
</tr>
</table>

### **üíª Implementation Squad**

<table>
<tr>
<td align="center" valign="top" width="33%">

### **Rex**
#### *The Backend Powerhouse*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/rex-avatar.png" width="180" height="180" alt="Rex Avatar">
</div>

ü¶Ä **Personality:** Hardcore backend engineer  
‚ö° **Superpower:** Lightning-fast Rust implementation  
üí¨ **Motto:** *"Zero-cost abstractions, max performance!"*

**Rex builds APIs, services, and backend infrastructure through `play()` workflows, specializing in Rust and high-performance systems.**

</td>
<td align="center" valign="top" width="33%">

### **Blaze**
#### *The Interface Maestro*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/blaze-avatar.png" width="180" height="180" alt="Blaze Avatar">
</div>

üé® **Personality:** Creative & UX obsessed  
‚ú® **Superpower:** Beautiful, responsive interfaces  
üí¨ **Motto:** *"Great UX makes complex simple!"*

**Blaze creates stunning frontends and user experiences, working alongside Rex for full-stack projects.**

</td>
<td align="center" valign="top" width="33%">

### **Cleo**
#### *The Quality Guardian*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/cleo-avatar.png" width="180" height="180" alt="Cleo Avatar">
</div>

üîç **Personality:** Meticulous & wise  
‚ú® **Superpower:** Spots improvements instantly  
üí¨ **Motto:** *"Excellence isn't negotiable!"*

**Cleo reviews code, refactors for quality, and ensures enterprise-grade standards in the quality phase of `play()` workflows.**

</td>
</tr>
</table>

### **üõ°Ô∏è Quality Assurance Squad**

<table>
<tr>
<td align="center" width="50%">

### **Cipher**
#### *The Security Sentinel*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/cipher-avatar.png" width="180" height="180" alt="Cipher Avatar">
</div>

üõ°Ô∏è **Personality:** Vigilant & protective  
üîí **Superpower:** Spots vulnerabilities early  
üí¨ **Motto:** *"Trust, but verify everything twice!"*

**Cipher handles security reviews, vulnerability scanning, and ensures enterprise-grade security across all workflows.**

</td>
<td align="center" width="50%">

### **Tess**
#### *The Testing Genius*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/tess-avatar.png" width="180" height="180" alt="Tess Avatar">
</div>

üïµÔ∏è **Personality:** Curious & thorough  
üé™ **Superpower:** Finds edge cases others miss  
üí¨ **Motto:** *"If it can break, I'll find it first!"*

**Tess creates comprehensive tests, validates functionality, and ensures reliability in the testing phase of `play()` workflows.**

</td>
</tr>
</table>

### **üöÄ Operations Squad**

<table>
<tr>
<td align="center" width="50%">

### **Atlas**
#### *The Integration Master*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/atlas-avatar.png" width="180" height="180" alt="Atlas Avatar">
</div>

üîó **Personality:** Systematic & reliable  
üåâ **Superpower:** Resolves conflicts seamlessly  
üí¨ **Motto:** *"Every branch finds its way home!"*

**Atlas manages PR merges, resolves conflicts automatically, and ensures clean integration with the main branch.**

</td>
<td align="center" width="50%">

### **Bolt**
#### *The Deployment Specialist*

<div align="center">
<img src="https://raw.githubusercontent.com/5dlabs/.github/main/profile/assets/bolt-avatar.png" width="180" height="180" alt="Bolt Avatar">
</div>

‚ö° **Personality:** Fast & action-oriented  
üöÄ **Superpower:** Lightning-speed deployments  
üí¨ **Motto:** *"Ship it fast, ship it right!"*

**Bolt handles infrastructure operations, monitors deployments, and ensures applications are accessible and healthy in production.**

</td>
</tr>
</table>

</div>

---

</div>

### üåü **The Magic: How Your AI Team Collaborates**

<div align="center">

**Watch the magic happen when they work together:**

<table>
<tr>
<td align="center" width="33%">

**üìö Phase 1**  
**Morgan** documents  
requirements & architecture

*via `docs()` MCP call*

</td>
<td align="center" width="33%">

**‚ö° Phase 2**  
**Rex & Blaze** build in parallel  
*(backend, frontend, or both)*

*via `play()` multi-agent workflows*

</td>
<td align="center" width="33%">

**üõ°Ô∏è Phase 3**  
**Cleo, Tess & Cipher** ensure  
quality, testing & security

*via `play()` multi-agent orchestration*

</td>
</tr>
</table>

**üí° Project Flexibility:**

<table>
<tr>
<td align="center" width="50%">
**ü¶Ä Backend Projects**<br/>
Rex builds APIs, services, databases
</td>
<td align="center" width="50%">
**‚ú® Frontend Projects**<br/>
Blaze creates UIs, dashboards, apps
</td>
</tr>
<tr>
<td align="center" width="50%">
**üöÄ Full-Stack Projects**<br/>
Rex & Blaze work together seamlessly
</td>
<td align="center" width="50%">
**üõ°Ô∏è Quality Always**<br/>
Cleo reviews, Tess tests, Cipher secures
</td>
</tr>
</table>

### **üéØ Result: Production-Ready Code**
*Fast ‚Ä¢ Elegant ‚Ä¢ Tested ‚Ä¢ Documented ‚Ä¢ Secure*

**It's like having a senior development team that never sleeps, never argues, and always delivers!** üé≠

</div>

---

## **‚ö° What CTO Does**

The Cognitive Task Orchestrator provides powerful tools for AI-driven development:

### **üìù Documentation Generation (`docs()`)**
**Morgan** analyzes your Task Master projects and creates comprehensive documentation automatically.

- Task breakdowns with acceptance criteria
- Implementation prompts for other agents
- Architecture documentation
- Automatic GitHub PR submission

### **üéÆ Multi-Agent Play Workflows (`play()`)**
**The entire team** orchestrates complex multi-agent workflows with event-driven coordination.

- **Phase 1 - Implementation**: Rex/Blaze build the core functionality
- **Phase 2 - Quality Assurance**: Cleo reviews and refactors
- **Phase 3 - Testing & Security**: Tess validates, Cipher secures
- **Event-Driven Coordination**: Automatic handoffs between phases
- **GitHub Integration**: Each phase submits detailed PRs

### **üöÄ Project Intake (`intake_prd()`)**
Automatically process PRDs and create structured TaskMaster projects.

- Reads project requirements and architecture
- Generates comprehensive task breakdown
- Creates TaskMaster structure with tasks.json
- Submits project setup as GitHub PR

### **üîß Workflow Management**
Control and monitor your AI development workflows:

- **`jobs()`** - List all running workflows with status
- **`stop_job()`** - Stop any running workflow gracefully
- **`docs_ingest()`** - Intelligently analyze and ingest documentation from GitHub repos

All operations run as **Kubernetes jobs** with enhanced reliability through TTL-safe reconciliation, preventing infinite loops and ensuring proper resource cleanup.

---

## **üöÄ Getting Started**

### Prerequisites
- Access to any AI coding assistant (Claude Code, Cursor, Factory, Codex, OpenCode, etc.)
- A project with Task Master initialized (`.taskmaster/` directory)
- GitHub repository for your project

---

## **üèóÔ∏è Platform Architecture**

This is an integrated platform with crystal-clear data flow:

**Component Architecture:**
- **MCP Server (`cto-mcp`)**: Handles MCP protocol calls from any CLI with configuration-driven defaults
- **Controller Service**: Kubernetes REST API that manages CodeRun/DocsRun CRDs via Argo Workflows
- **Argo Workflows**: Orchestrates agent deployment through workflow templates
- **Kubernetes Controllers**: Separate controllers for CodeRun and DocsRun resources with TTL-safe reconciliation
- **Agent Workspaces**: Isolated persistent volumes for each service with session continuity
- **GitHub Apps**: Secure authentication system replacing personal tokens

**Data Flow:**
1. Any CLI calls MCP tools (`docs()`, `play()`, `intake_prd()`, etc.) via MCP protocol
2. MCP server loads configuration from `cto-config.json` and applies defaults
3. MCP server submits workflow to Argo with all required parameters
4. Argo Workflows creates CodeRun/DocsRun custom resources
5. Dedicated Kubernetes controllers reconcile CRDs with idempotent job management
6. Controllers deploy configured CLI agents (Claude Code, Cursor, Factory, Codex, OpenCode, etc.) as Jobs with workspace isolation
7. Agents authenticate via GitHub Apps and complete work
8. Agents submit GitHub PRs with automatic cleanup

---

## **üì¶ Installation**

### Deploy the Complete Platform

```bash
# Add the 5dlabs Helm repository
helm repo add 5dlabs https://5dlabs.github.io/cto
helm repo update

# Install Custom Resource Definitions (CRDs) first
kubectl apply -f https://raw.githubusercontent.com/5dlabs/cto/main/infra/charts/agent-platform/crds/platform-crds.yaml

# Install the agent-platform
helm install agent-platform 5dlabs/agent-platform --namespace agent-platform --create-namespace

# Setup agent secrets (interactive)
wget https://raw.githubusercontent.com/5dlabs/cto/main/infra/scripts/setup-agent-secrets.sh
chmod +x setup-agent-secrets.sh
./setup-agent-secrets.sh --help
```

**Requirements:**
- Kubernetes 1.19+
- Helm 3.2.0+
- GitHub Personal Access Token
- Anthropic API Key

**What you get:**
- Complete agent-platform platform deployed to Kubernetes
- REST API for task management
- Separate Kubernetes controllers for CodeRun/DocsRun resources with TTL-safe reconciliation
- Agent workspace management and isolation with persistent volumes
- Automatic resource cleanup and job lifecycle management
- MCP tools that connect to your deployment

### Remote Cluster Access with Kilo VPN

Kilo is an open-source WireGuard-based VPN that provides secure access to cluster services. It's deployed automatically via ArgoCD.

**Client Setup:**

1. Install WireGuard and kgctl:
```bash
# macOS
brew install wireguard-tools
go install github.com/squat/kilo/cmd/kgctl@latest

# Linux
sudo apt install wireguard-tools
go install github.com/squat/kilo/cmd/kgctl@latest
```

2. Generate your WireGuard keys and create a Peer resource (see `docs/vpn/kilo-client-setup.md`)

3. Connect to access cluster services:
```bash
sudo wg-quick up ~/.wireguard/kilo.conf
```

This enables direct access to:
- ClusterIPs (e.g., `curl http://10.x.x.x:port`)
- Service DNS (e.g., `curl http://service.namespace.svc.cluster.local`)

See `docs/vpn/kilo-client-setup.md` for full setup instructions.

### Install MCP Server

For CLI integration (Cursor, Claude Code, etc.), install the MCP server:

```bash
# One-liner installer (Linux/macOS)
curl --proto '=https' --tlsv1.2 -LsSf https://github.com/5dlabs/cto/releases/download/v0.2.0/tools-installer.sh | sh

# Verify installation
cto-mcp --help   # MCP server for any CLI
```

**What you get:**
- `cto-mcp` - MCP server that integrates with any CLI
- Multi-platform support (Linux x64/ARM64, macOS Intel/Apple Silicon, Windows x64)
- Automatic installation to system PATH

---

## **‚öôÔ∏è Configuration**

### Configure Project Settings

Create a `cto-config.json` file in your project root to configure agents, models, tool access, and workflow defaults:

```json
{
  "version": "1.0",
  "defaults": {
    "docs": {
      "model": "claude-opus-4-1-20250805",
      "githubApp": "5DLabs-Morgan",
      "includeCodebase": false,
      "sourceBranch": "main"
    },
    "play": {
      "model": "claude-sonnet-4-20250514",
      "cli": "claude",
      "implementationAgent": "5DLabs-Rex",
      "qualityAgent": "5DLabs-Cleo",
      "testingAgent": "5DLabs-Tess",
      "repository": "your-org/your-repo",
      "service": "your-service",
      "docsRepository": "your-org/your-docs-repo",
      "docsProjectDirectory": "docs"
    },
    "intake": {
      "githubApp": "5DLabs-Morgan",
      "primary": {
        "model": "opus",
        "provider": "claude-code"
      },
      "research": {
        "model": "opus",
        "provider": "claude-code"
      },
      "fallback": {
        "model": "gpt-5",
        "provider": "openai"
      }
    },
    "docs_ingest": {
      "model": "claude-sonnet-4-20250514",
      "docServerUrl": "http://doc-server-agent-docs-server.mcp.svc.cluster.local:80"
    }
  },
  "agents": {
    "morgan": {
      "githubApp": "5DLabs-Morgan",
      "cli": "claude",
      "model": "claude-sonnet-4-20250514",
      "tools": {
        "remote": [
          "memory_create_entities",
          "memory_add_observations",
          "brave_search_brave_web_search",
          "rustdocs_query_rust_docs"
        ],
        "localServers": {
          "filesystem": {
            "enabled": true,
            "tools": ["read_file", "write_file", "list_directory", "search_files", "directory_tree"]
          },
          "git": {
            "enabled": true,
            "tools": ["git_status", "git_diff", "git_log", "git_show"]
          }
        }
      }
    },
    "rex": {
      "githubApp": "5DLabs-Rex",
      "cli": "codex",
      "model": "gpt-5-codex",
      "tools": {
        "remote": [
          "memory_create_entities",
          "memory_add_observations",
          "rustdocs_query_rust_docs"
        ],
        "localServers": {
          "filesystem": {
            "enabled": true,
            "tools": ["read_file", "write_file", "list_directory", "search_files", "directory_tree"]
          },
          "git": {
            "enabled": true,
            "tools": ["git_status", "git_diff", "git_log", "git_show"]
          }
        }
      }
    },
    "cleo": {
      "githubApp": "5DLabs-Cleo",
      "cli": "claude",
      "model": "claude-sonnet-4-20250514",
      "tools": {
        "remote": ["memory_create_entities", "memory_add_observations", "rustdocs_query_rust_docs"],
        "localServers": {
          "filesystem": {"enabled": true, "tools": ["read_file", "write_file", "list_directory", "search_files", "directory_tree"]},
          "git": {"enabled": true, "tools": ["git_status", "git_diff", "git_log", "git_show"]}
        }
      }
    },
    "tess": {
      "githubApp": "5DLabs-Tess",
      "cli": "claude",
      "model": "claude-sonnet-4-20250514",
      "tools": {
        "remote": ["memory_create_entities", "memory_add_observations"],
        "localServers": {
          "filesystem": {"enabled": true, "tools": ["read_file", "write_file", "list_directory", "search_files", "directory_tree"]},
          "git": {"enabled": true, "tools": ["git_status", "git_diff"]}
        }
      }
    }
  }
}
```

**Agent Configuration Fields:**
- **`githubApp`**: GitHub App name for authentication
- **`cli`**: Which CLI to use (`claude`, `cursor`, `codex`, `opencode`, `factory`)
- **`model`**: Model identifier for the CLI
- **`tools`** (optional): Fine-grained tool access control
  - **`remote`**: Array of remote tool names from Toolman
  - **`localServers`**: Local MCP server configurations
    - Each server specifies `enabled` and which `tools` the agent can access

**Benefits:**
- **CLI Flexibility**: Different agents can use different CLIs
- **Model Selection**: Each agent can use its optimal model
- **Tool Profiles**: Customize tool access per agent
- **Security**: Restrict agent capabilities as needed

### Configure MCP Integration

After creating your configuration file, configure your CLI to use the MCP server.

**For Cursor**, create a `.cursor/mcp.json` file in your project directory:

```json
{
  "mcpServers": {
    "cto-mcp": {
      "command": "cto-mcp",
      "args": [],
      "env": {}
    }
  }
}
```

**For Claude Code**, add to your MCP configuration (typically in `~/.config/claude/mcp.json`):

```json
{
  "mcpServers": {
    "cto-mcp": {
      "command": "cto-mcp",
      "args": []
    }
  }
}
```

**Usage:**
1. Create the `cto-config.json` file in your project root with your specific settings
2. Configure your CLI's MCP integration as shown above
3. Restart your CLI to load the MCP server
4. All MCP tools will be available with your configured defaults

**Benefits of Configuration-Driven Approach:**
- **Simplified MCP Calls**: Most parameters have sensible defaults from your config
- **Dynamic Agent Lists**: Tool descriptions show available agents from your config
- **Consistent Settings**: All team members use the same model/agent assignments
- **Easy Customization**: Change defaults without modifying MCP server setup

---

## **üé® Multi-CLI Support**

The platform supports multiple AI coding assistants with the same unified architecture. Choose the CLI that best fits your workflow:

<table>
<tr>
<td align="center" width="20%">

### **Claude Code**
Official Anthropic CLI
- **Native Integration**
- Best for Claude models
- Enterprise-ready

</td>
<td align="center" width="20%">

### **Cursor**
Popular AI editor
- **VS Code-based**
- Rich IDE features
- Excellent UX

</td>
<td align="center" width="20%">

### **Codex**
Multi-model support
- **Provider Agnostic**
- Flexible configuration
- OpenAI, Anthropic, more

</td>
<td align="center" width="20%">

### **OpenCode**
Open-source CLI
- **Community Driven**
- Extensible architecture
- Full transparency

</td>
<td align="center" width="20%">

### **Factory**
Autonomous AI CLI
- **Auto-Run Mode**
- Unattended execution
- CI/CD optimized

</td>
</tr>
</table>

**How It Works:**
- Each agent in `cto-config.json` specifies its `cli` and `model`
- Controllers automatically use the correct CLI for each agent
- All CLIs follow the same template structure
- Seamless switching between CLIs per-agent

**Example Multi-CLI Configuration:**
```json
{
  "agents": {
    "morgan": {
      "githubApp": "5DLabs-Morgan",
      "cli": "claude",
      "model": "claude-opus-4-20250514",
      "tools": {
        "remote": ["brave_search_brave_web_search", "rustdocs_query_rust_docs"]
      }
    },
    "rex": {
      "githubApp": "5DLabs-Rex",
      "cli": "factory",
      "model": "gpt-5-factory-high",
      "tools": {
        "remote": ["memory_create_entities", "rustdocs_query_rust_docs"]
      }
    },
    "blaze": {
      "githubApp": "5DLabs-Blaze",
      "cli": "opencode",
      "model": "claude-sonnet-4-20250514",
      "tools": {
        "remote": ["brave_search_brave_web_search"]
      }
    },
    "cleo": {
      "githubApp": "5DLabs-Cleo",
      "cli": "cursor",
      "model": "claude-sonnet-4-20250514",
      "tools": {
        "localServers": {
          "filesystem": {"enabled": true, "tools": ["read_file", "write_file"]}
        }
      }
    },
    "tess": {
      "githubApp": "5DLabs-Tess",
      "cli": "codex",
      "model": "gpt-4o",
      "tools": {
        "remote": ["memory_add_observations"]
      }
    }
  }
}
```

Each agent independently configured with its own CLI, model, and tool access.

---

## **üîß MCP Tools Reference**

The platform exposes 7 powerful MCP tools for AI-driven development:

### 1. **`docs()` - Morgan's Documentation Magic**
Analyzes your Task Master project and creates comprehensive documentation.

```javascript
// Minimal call using config defaults
docs({
  working_directory: "projects/my-app"
});

// Override specific parameters if needed
docs({
  working_directory: "projects/my-app",
  agent: "morgan",
  model: "claude-opus-4-20250514",
  include_codebase: true
});
```

**What Morgan does:**
‚úÖ Analyzes all tasks in your Task Master project  
‚úÖ Generates comprehensive documentation  
‚úÖ Creates implementation guidance for other agents  
‚úÖ Submits a GitHub PR with all documentation

### 2. **`play()` - Multi-Agent Orchestration**
Executes complex multi-agent workflows with event-driven coordination.

```javascript
// Minimal call - the whole team collaborates!
play({
  task_id: 1
});

// Customize agent assignments
play({
  task_id: 1,
  implementation_agent: "rex",
  quality_agent: "cleo",
  testing_agent: "tess",
  repository: "myorg/my-project"
});
```

**What the team does:**
‚úÖ **Phase 1 - Implementation**: Rex/Blaze builds the feature  
‚úÖ **Phase 2 - Quality**: Cleo reviews and refactors  
‚úÖ **Phase 3 - Testing**: Tess validates and tests  
‚úÖ **Event-Driven**: Automatic phase transitions  
‚úÖ **GitHub Integration**: PRs from each phase

### 3. **`intake_prd()` - Project Intake Automation**
Process PRDs and create structured TaskMaster projects.

```javascript
// Process a new project
intake_prd({
  project_name: "my-awesome-app"
});

// Customize models and agents
intake_prd({
  project_name: "my-awesome-app",
  github_app: "5DLabs-Morgan",
  primary_model: "claude-opus-4-20250514"
});
```

**What intake does:**
‚úÖ Reads PRD from `{project_name}/intake/prd.txt`  
‚úÖ Analyzes requirements and architecture  
‚úÖ Generates comprehensive task breakdown  
‚úÖ Creates TaskMaster structure with tasks.json  
‚úÖ Submits project setup as GitHub PR

### 4. **`jobs()` - Workflow Status**
List all running Argo workflows with simplified status info.

```javascript
// List all workflows
jobs();

// Filter by type
jobs({
  include: ["play", "intake"]
});

// Specify namespace
jobs({
  namespace: "agent-platform"
});
```

**Returns:** List of active workflows with type, name, phase, and status

### 5. **`stop_job()` - Workflow Control**
Stop any running Argo workflow gracefully.

```javascript
// Stop a specific workflow
stop_job({
  job_type: "play",
  name: "play-workflow-abc123"
});

// Stop with explicit namespace
stop_job({
  job_type: "intake",
  name: "intake-workflow-xyz789",
  namespace: "agent-platform"
});
```

**Workflow types:** `intake`, `play`, `workflow`

### 6. **`docs_ingest()` - Documentation Analysis**
Intelligently analyze GitHub repos and ingest documentation.

```javascript
// Ingest repository documentation
docs_ingest({
  repository_url: "https://github.com/cilium/cilium",
  doc_type: "cilium"
});

// Custom doc server
docs_ingest({
  repository_url: "https://github.com/solana-labs/solana",
  doc_type: "solana",
  doc_server_url: "http://my-doc-server:80"
});
```

**What it does:**
‚úÖ Uses Claude to analyze repository structure  
‚úÖ Determines optimal ingestion strategy  
‚úÖ Processes documentation intelligently  
‚úÖ Stores in searchable format for agents

---

## **üìã Complete MCP Tool Parameters**

### `docs` Tool Parameters

**Required:**
- `working_directory` - Working directory containing .taskmaster folder (e.g., `"projects/simple-api"`)

**Optional (with config defaults):**
- `agent` - Agent name to use (defaults to `defaults.docs.githubApp` mapping)
- `model` - Model to use for the docs agent (defaults to `defaults.docs.model`)
- `source_branch` - Source branch to work from (defaults to `defaults.docs.sourceBranch`)
- `include_codebase` - Include existing codebase as context (defaults to `defaults.docs.includeCodebase`)

### `play` Tool Parameters

**Required:**
- `task_id` - Task ID to implement from task files (integer, minimum 1)

**Optional (with config defaults):**
- `repository` - Target repository URL (e.g., `"5dlabs/cto"`) (defaults to `defaults.play.repository`)
- `service` - Service identifier for persistent workspace (defaults to `defaults.play.service`)
- `docs_repository` - Documentation repository URL (defaults to `defaults.play.docsRepository`)
- `docs_project_directory` - Project directory within docs repository (defaults to `defaults.play.docsProjectDirectory`)
- `implementation_agent` - Agent for implementation work (defaults to `defaults.play.implementationAgent`)
- `quality_agent` - Agent for quality assurance (defaults to `defaults.play.qualityAgent`)
- `testing_agent` - Agent for testing and validation (defaults to `defaults.play.testingAgent`)
- `model` - Model to use for play-phase agents (defaults to `defaults.play.model`)

---

## **üé® Template Customization**

The platform uses a template system to customize agent behavior, settings, and prompts. Templates are Handlebars (`.hbs`) files rendered with task-specific data at runtime. Multi-CLI support lives alongside these templates so Claude, Codex, and future CLIs follow the same structure.

**Model Defaults**: Models are configured through `cto-config.json` defaults (and can be overridden via MCP parameters). We ship presets for Claude (`claude-sonnet-4-20250514`), Codex (`gpt-5-codex`), and Factory (`gpt-5-factory-high`), but any supported model for a CLI can be supplied via configuration.

### Template Architecture

All templates now live under `infra/charts/controller/agent-templates/` with CLI-specific subdirectories:

**Docs Tasks (Multi-CLI Support)**

- **Prompts**: Rendered from `docs/{cli}/prompt.md.hbs` into the ConfigMap
- **Settings**: `docs/{cli}/settings.json.hbs` controls model, permissions, tools
- **Container Script**: `docs/{cli}/container.sh.hbs` handles Git workflow and CLI execution

**Code Tasks (multi-CLI)**

- **Claude**: `code/claude/**`
  - Settings: `code/claude/settings.json.hbs`
  - Container: `code/claude/container.sh.hbs`
- **Codex**: `code/codex/**`
  - Agents memory: `code/codex/agents.md.hbs`
  - Config: `code/codex/config.toml.hbs`
  - Container scripts: `code/codex/container*.sh.hbs`
- **Factory**: `code/factory/**`
  - Agents memory: `code/factory/agents*.md.hbs`
  - Config: `code/factory/factory-cli-config.json.hbs`
  - Container scripts: `code/factory/container*.sh.hbs`
- **Shared assets**: `code/mcp.json.hbs`, `code/coding-guidelines.md.hbs`, and `code/github-guidelines.md.hbs`

**Play Workflows**: Multi-agent orchestration with event-driven coordination

- **Workflow Template**: `play-workflow-template.yaml` defines the multi-phase workflow
- **Phase Coordination**: Each phase triggers the next phase automatically
- **Agent Handoffs**: Seamless transitions between implementation ‚Üí QA ‚Üí testing phases

### How to Customize

#### 1. Changing Agent Settings

Edit the settings template files for your chosen CLI:

```bash
# For docs agents (Claude Code example)
vim infra/charts/controller/agent-templates/docs/claude/settings.json.hbs

# For code agents (Claude Code example)
vim infra/charts/controller/agent-templates/code/claude/settings.json.hbs

# For code agents (Codex example)
vim infra/charts/controller/agent-templates/code/codex/config.toml.hbs

# For code agents (Factory example)
vim infra/charts/controller/agent-templates/code/factory/factory-cli-config.json.hbs
```

Settings control:
- Model selection (CLI-specific model identifiers)
- Tool permissions and access
- MCP tool configuration
- CLI-specific settings (permissions, hooks, etc.)

Refer to your CLI's documentation for complete configuration options:
- [Claude Code Settings](https://docs.anthropic.com/en/docs/claude-code/settings)
- [Factory CLI Documentation](https://docs.factory.ai)
- Other CLIs: Refer to their respective documentation

#### 2. Updating Prompts

**For docs tasks** (affects all documentation generation):

```bash
# Edit the docs prompt template for your CLI
vim infra/charts/controller/agent-templates/docs/{cli}/prompt.md.hbs

# Examples:
vim infra/charts/controller/agent-templates/docs/claude/prompt.md.hbs
vim infra/charts/controller/agent-templates/docs/cursor/prompt.md.hbs
```

**For code tasks** (affects specific task implementation):

```bash
# Edit task-specific files in your docs repository
vim {docs_project_directory}/.taskmaster/docs/task-{id}/prompt.md
vim {docs_project_directory}/.taskmaster/docs/task-{id}/task.md
vim {docs_project_directory}/.taskmaster/docs/task-{id}/acceptance-criteria.md
```

#### 3. Customizing Play Workflows

**For play workflows** (affects multi-agent orchestration):

```bash
# Edit the play workflow template
vim infra/charts/controller/templates/workflowtemplates/play-workflow-template.yaml
```

The play workflow template controls:
- Phase sequencing and dependencies
- Agent assignments for each phase
- Event triggers between phases
- Parameter passing between phases

#### 4. Adding Custom Hooks

Hooks are shell scripts that run during agent execution. Add new hook files beneath the CLI you are extending:

```bash
# Create new hook script (docs/Claude Code example)
vim infra/charts/controller/agent-templates/docs/claude/hooks/my-custom-hook.sh.hbs

# Create new hook script (code/Codex example)
vim infra/charts/controller/agent-templates/code/codex/hooks/my-custom-hook.sh.hbs

# Create new hook script (code/Factory example)
vim infra/charts/controller/agent-templates/code/factory/hooks/my-custom-hook.sh.hbs
```

Hook files are automatically discovered and rendered. Ensure the hook name matches any references in your settings templates.

Refer to your CLI's documentation for hook configuration:
- [Claude Code Hooks Guide](https://docs.anthropic.com/en/docs/claude-code/hooks-guide)
- Other CLIs: Refer to their respective documentation for hook/script support

#### 5. Deploying Template Changes

After editing any template files, redeploy the agent-platform:

```bash
# Deploy template changes
helm upgrade agent-platform infra/charts/controller -n agent-platform

# Verify ConfigMap was updated (fullname = <release>-controller)
kubectl get configmap agent-platform-controller-agent-templates -n agent-platform -o yaml
```

**Important**: Template changes only affect new agent jobs. Running jobs continue with their original templates.

### Template Variables

Common variables available in templates:
- `{{task_id}}` - Task ID for code tasks
- `{{service_name}}` - Target service name
- `{{github_user}}` - GitHub username
- `{{repository_url}}` - Target repository URL
- `{{working_directory}}` - Working directory path
- `{{model}}` - Claude model name
- `{{docs_repository_url}}` - Documentation repository URL

---

## **üí° Best Practices**

1. **Configure `cto-config.json` first** to set up your agents, models, tool profiles, and repository defaults
2. **Always generate docs first** to establish baseline documentation using `docs()`
3. **Choose the right tool for the job**:
   - Use `docs()` for documentation generation
   - Use `play()` for full-cycle development (implementation ‚Üí QA ‚Üí testing)
   - Use `intake_prd()` for new project setup from PRDs
   - Use `jobs()` / `stop_job()` for workflow management
4. **Mix and match CLIs** - assign the best CLI to each agent based on task requirements
5. **Customize tool access** - use the `tools` configuration to control agent capabilities
6. **Use minimal MCP calls** - let configuration defaults handle most parameters
7. **Review GitHub PRs promptly** - agents provide detailed logs and explanations
8. **Update config file** when adding new agents, tools, or changing project structure

---

## **üõ†Ô∏è Building from Source (Development)**

```bash
# Build from source
git clone https://github.com/5dlabs/cto.git
cd cto/controller

# Build MCP server
cargo build --release --bin cto-mcp

# Verify the build
./target/release/cto-mcp --help   # MCP server

# Install to your system (optional)
cp target/release/cto-mcp /usr/local/bin/
```

---

## **üÜò Support**

- Check GitHub PRs for detailed agent logs and explanations
- Review Task Master project structure in `.taskmaster/` directory
- Verify `cto-config.json` configuration and GitHub Apps authentication setup
- Ensure Argo Workflows are properly deployed and accessible

---

## **üìÑ License**

This project is licensed under the GNU Affero General Public License v3.0 (AGPL-3.0). This means:

- You can use, modify, and distribute this software freely
- You can use it for commercial purposes
- ‚ö†Ô∏è If you deploy a modified version on a network server, you must provide source code access to users
- ‚ö†Ô∏è Any derivative works must also be licensed under AGPL-3.0

The AGPL license is specifically designed for server-side software to ensure that improvements to the codebase remain open source, even when deployed as a service. This protects the open source nature of the project while allowing commercial use.

**Source Code Access**: Since this platform operates as a network service, users interacting with it have the right to access the source code under AGPL-3.0. The complete source code is available at this repository, ensuring full compliance with AGPL-3.0's network clause.

For more details, see the [LICENSE](LICENSE) file.

---

## **üîó Related Projects**

- **[Task Master AI](https://github.com/eyaltoledano/claude-task-master)** - The AI-powered task management system that works perfectly with this platform. Task Master AI helps you break down complex projects into manageable tasks, which can then be implemented using this platform's `play()` and `intake_prd()` MCP tools.

---

## **üöÄ Roadmap**

See our [ROADMAP.md](ROADMAP.md) for upcoming features and planned enhancements to the platform.

---

<div align="center">

### **üåü Join the AI Development Revolution**

| | | | |
|:---:|:---:|:---:|:---:|
| [**‚≠ê Star**](https://github.com/5dlabs/cto)<br/>Support project | [**üç¥ Fork**](https://github.com/5dlabs/cto/fork)<br/>Build with us | [**üí¨ Discord**](https://discord.gg/A6yydvjZKY)<br/>Join community | [**üê¶ X**](https://x.com/5dlabs)<br/>Get updates |
| [**üì∫ YouTube**](https://www.youtube.com/@5DLabs)<br/>Watch tutorials | [**üìñ Docs**](https://docs.5dlabs.com)<br/>Learn more | [**üêõ Issues**](https://github.com/5dlabs/cto/issues)<br/>Report bugs | [**üí° Discuss**](https://github.com/orgs/5dlabs/discussions)<br/>Share ideas |

**Built with ‚ù§Ô∏è and ü§ñ by the 5D Labs Team**

---

*The platform runs on Kubernetes and automatically manages multi-CLI agent deployments, workspace isolation, and GitHub integration. All you need to do is call the MCP tools and review the resulting PRs.*

</div>
