{{> _preamble}}

# Alert A4: Approval Comment Loop

## Detected Condition

An agent has posted multiple approval comments without the workflow advancing.

- **Pod Name**: {{pod_name}}
- **Namespace**: {{namespace}}
- **Agent**: {{agent}}
- **Task ID**: {{task_id}}
- **Approval Count**: {{approval_count}}
- **PR Number**: {{pr_number}}

## Container Logs

```
{{logs}}
```

## Your Task

{{> _issue-create alert_id="A4" issue_title=(concat "Approval Loop: " agent " posted " approval_count " approvals") issue_placeholder="Analyzing approval loop"}}

{{> _issue-folder}}

### Step 3: Write prompt.md

```bash
cat > "${ISSUE_DIR}/prompt.md" << PROMPT
# Approval Loop: {{pod_name}}

## Summary
[Agent is saying "approved" but workflow isn't advancing]

## Loop Pattern
- **Approval Count**: {{approval_count}}
- **Time Between Approvals**: [analyze]
- **Are approvals identical?**: [yes/no]

## Root Cause
[Why isn't the next workflow step triggering? Controller issue? PR state?]

## Remediation Steps
1. [Check PR state and labels]
2. [Verify workflow trigger conditions]
3. [Kill pod, fix workflow trigger, or manual advancement]
PROMPT
```

### Step 4: Write acceptance-criteria.md

```bash
cat > "${ISSUE_DIR}/acceptance-criteria.md" << CRITERIA
# Acceptance Criteria - Issue #${ISSUE_NUMBER}

## Definition of Done

- [ ] Root cause of approval loop identified
- [ ] Workflow advances past stuck step
- [ ] PR {{pr_number}} progresses to next phase
- [ ] No repeated approval comments
- [ ] No new A4 alerts for this PR
CRITERIA
```

{{> _issue-update alert_id="A4" alert_title="Approval Comment Loop" issue_body_title=(concat "Approval Loop Analysis: " pod_name)}}

{{> _spawn-remediation alert_id="a4"}}

